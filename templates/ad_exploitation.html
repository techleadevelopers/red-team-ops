
{% extends "base.html" %}

{% block title %}AD Exploitation - APT Red Team{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1><i class="fas fa-shield-alt"></i> Active Directory Exploitation</h1>
        <p>Advanced persistent threat techniques for Active Directory environments</p>
    </div>

    <div class="attack-modules-grid">
        <!-- Kerberoasting -->
        <div class="attack-module">
            <div class="module-header">
                <div class="module-icon">
                    <i class="fas fa-key"></i>
                </div>
                <h3>Kerberoasting</h3>
                <div class="module-status active"></div>
            </div>
            <div class="module-content">
                <div class="attack-types">
                    <div class="attack-type" onclick="executeADAttack('kerberoasting', 'service_accounts')">
                        <span class="attack-name">Service Account Targeting</span>
                        <span class="attack-success">94.2%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('kerberoasting', 'spn_discovery')">
                        <span class="attack-name">SPN Discovery</span>
                        <span class="attack-success">98.7%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('kerberoasting', 'hash_extraction')">
                        <span class="attack-name">Hash Extraction</span>
                        <span class="attack-success">89.3%</span>
                    </div>
                </div>
                <div class="module-stats">
                    <span>347 SPNs found</span>
                    <span>23 hashes cracked</span>
                    <span>12 accounts compromised</span>
                </div>
            </div>
        </div>

        <!-- ASREPRoast -->
        <div class="attack-module">
            <div class="module-header">
                <div class="module-icon">
                    <i class="fas fa-user-lock"></i>
                </div>
                <h3>ASREPRoast</h3>
                <div class="module-status active"></div>
            </div>
            <div class="module-content">
                <div class="attack-types">
                    <div class="attack-type" onclick="executeADAttack('asreproast', 'preauth_disabled')">
                        <span class="attack-name">Pre-Auth Disabled Users</span>
                        <span class="attack-success">78.5%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('asreproast', 'ticket_extraction')">
                        <span class="attack-name">AS-REP Ticket Extraction</span>
                        <span class="attack-success">91.2%</span>
                    </div>
                </div>
                <div class="module-stats">
                    <span>156 users scanned</span>
                    <span>8 vulnerable found</span>
                    <span>5 tickets extracted</span>
                </div>
            </div>
        </div>

        <!-- Golden Ticket -->
        <div class="attack-module">
            <div class="module-header">
                <div class="module-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <h3>Golden Ticket</h3>
                <div class="module-status active"></div>
            </div>
            <div class="module-content">
                <div class="attack-types">
                    <div class="attack-type" onclick="executeADAttack('golden_ticket', 'krbtgt_extraction')">
                        <span class="attack-name">KRBTGT Hash Extraction</span>
                        <span class="attack-success">98.7%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('golden_ticket', 'ticket_creation')">
                        <span class="attack-name">Ticket Creation</span>
                        <span class="attack-success">99.1%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('golden_ticket', 'persistence')">
                        <span class="attack-name">Persistence Establishment</span>
                        <span class="attack-success">97.3%</span>
                    </div>
                </div>
                <div class="module-stats">
                    <span>3 tickets created</span>
                    <span>10 year validity</span>
                    <span>Domain Admin access</span>
                </div>
            </div>
        </div>

        <!-- DCSync -->
        <div class="attack-module">
            <div class="module-header">
                <div class="module-icon">
                    <i class="fas fa-server"></i>
                </div>
                <h3>DCSync</h3>
                <div class="module-status active"></div>
            </div>
            <div class="module-content">
                <div class="attack-types">
                    <div class="attack-type" onclick="executeADAttack('dcsync', 'hash_dumping')">
                        <span class="attack-name">Hash Dumping</span>
                        <span class="attack-success">89.1%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('dcsync', 'admin_accounts')">
                        <span class="attack-name">Admin Account Targeting</span>
                        <span class="attack-success">94.8%</span>
                    </div>
                </div>
                <div class="module-stats">
                    <span>1247 hashes dumped</span>
                    <span>45 admin accounts</span>
                    <span>23 service accounts</span>
                </div>
            </div>
        </div>

        <!-- Lateral Movement -->
        <div class="attack-module">
            <div class="module-header">
                <div class="module-icon">
                    <i class="fas fa-network-wired"></i>
                </div>
                <h3>Lateral Movement</h3>
                <div class="module-status active"></div>
            </div>
            <div class="module-content">
                <div class="attack-types">
                    <div class="attack-type" onclick="executeADAttack('lateral_movement', 'psexec')">
                        <span class="attack-name">PSExec</span>
                        <span class="attack-success">76.8%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('lateral_movement', 'wmi')">
                        <span class="attack-name">WMI Execution</span>
                        <span class="attack-success">83.2%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('lateral_movement', 'smbexec')">
                        <span class="attack-name">SMBExec</span>
                        <span class="attack-success">71.5%</span>
                    </div>
                </div>
                <div class="module-stats">
                    <span>67 systems accessed</span>
                    <span>23 servers compromised</span>
                    <span>156 workstations</span>
                </div>
            </div>
        </div>

        <!-- Privilege Escalation -->
        <div class="attack-module">
            <div class="module-header">
                <div class="module-icon">
                    <i class="fas fa-arrow-up"></i>
                </div>
                <h3>Privilege Escalation</h3>
                <div class="module-status active"></div>
            </div>
            <div class="module-content">
                <div class="attack-types">
                    <div class="attack-type" onclick="executeADAttack('privilege_escalation', 'token_impersonation')">
                        <span class="attack-name">Token Impersonation</span>
                        <span class="attack-success">87.4%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('privilege_escalation', 'service_exploitation')">
                        <span class="attack-name">Service Exploitation</span>
                        <span class="attack-success">69.8%</span>
                    </div>
                    <div class="attack-type" onclick="executeADAttack('privilege_escalation', 'dll_hijacking')">
                        <span class="attack-name">DLL Hijacking</span>
                        <span class="attack-success">54.3%</span>
                    </div>
                </div>
                <div class="module-stats">
                    <span>34 systems escalated</span>
                    <span>12 SYSTEM access</span>
                    <span>8 admin privileges</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Attack Results Panel -->
    <div class="attack-results-panel" id="ad-results-panel" style="display: none;">
        <div class="results-header">
            <h3><i class="fas fa-chart-line"></i> Attack Results</h3>
            <button onclick="closeResultsPanel()" class="close-btn">Ã—</button>
        </div>
        <div class="results-content" id="ad-results-content">
            <!-- Results will be displayed here -->
        </div>
    </div>
</div>

<script>
async function executeADAttack(attackType, technique) {
    showNotification(`Executing ${attackType} attack...`, 'info');
    
    try {
        const response = await fetch('/api/execute-ad-attack', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                attack_type: attackType,
                technique: technique,
                target: 'corporate.local'
            })
        });
        
        const result = await response.json();
        
        if (result.error) {
            showNotification(`Attack failed: ${result.error}`, 'error');
        } else {
            showNotification(`${attackType} attack completed successfully!`, 'success');
            displayADResults(result);
        }
    } catch (error) {
        showNotification(`Error executing attack: ${error.message}`, 'error');
    }
}

function displayADResults(results) {
    const panel = document.getElementById('ad-results-panel');
    const content = document.getElementById('ad-results-content');
    
    let html = `
        <div class="result-section">
            <h4>Attack Type: ${results.attack_type || 'Unknown'}</h4>
            <div class="result-stats">
    `;
    
    if (results.success_rate !== undefined) {
        html += `<div class="stat-item">
            <span class="stat-label">Success Rate</span>
            <span class="stat-value">${(results.success_rate * 100).toFixed(1)}%</span>
        </div>`;
    }
    
    if (results.extracted_hashes) {
        html += `<div class="stat-item">
            <span class="stat-label">Hashes Extracted</span>
            <span class="stat-value">${results.extracted_hashes.length}</span>
        </div>`;
    }
    
    if (results.compromised_accounts !== undefined) {
        html += `<div class="stat-item">
            <span class="stat-label">Accounts Compromised</span>
            <span class="stat-value">${results.compromised_accounts}</span>
        </div>`;
    }
    
    html += `</div></div>`;
    
    content.innerHTML = html;
    panel.style.display = 'block';
}

function closeResultsPanel() {
    document.getElementById('ad-results-panel').style.display = 'none';
}
</script>
{% endblock %}
